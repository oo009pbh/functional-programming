![[Pasted image 20240529150123.png]]

*ì•„ëž˜ì—ì„œ ì‚¬ìš©ë  í•¨ìˆ˜(go, curry...)ë“¤ì€ ì´ì „ í¬ìŠ¤íŠ¸ë“¤ì—ì„œ ì„¤ëª…ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.

## ðŸ“—Promise vs Callback

`Promise` í˜•ì‹ì˜ ì½”ë”©ê³¼ `Callback` í˜•ì‹ì˜ ì½”ë”©ì—ëŠ” ë§Žì€ ì°¨ì´ê°€ ìžˆë‹¤.

ì²«ë²ˆì§¸ë¡œ ê°€ë…ì„±ì´ë‹¤,

```js

function add10(a, callback) {
    setTimeout(() => callback(a + 10), 100);
  }

//ì½œë°±ì´ ê²¹ê²¹ížˆ ìŒ“ì´ë©´ ì•ˆì— ë¡œì§ ë³´ê¸°ê°€ íž˜ë“¤ë‹¤.
add10(5, res => {
	add10(res, res => {
		add10(res, res => {
		    add10(res, res => {
				add10(res, res => {
					//  ì½œë°±ì§€ì˜¥ì´ ë°œìƒí• ìˆ˜ ìžˆë‹¤.
				});
			});
		});
	});
});

function add20(a) {
  return new Promise(resolve => setTimeout(() => resolve(a + 20), 100));
}

// .then í˜•ì‹ìœ¼ë¡œ ë¹„ë™ê¸° ìƒí™©ì´ ë¹„êµì  ëª…í™•í•˜ê²Œ ë³´ì¸ë‹¤.
add20(5)
  .then(add20)
  .then(add20)
  .then(add20)
  .then(add20)
  .then(add20)
```

ìœ„ì™€ ê°™ì´ `Promise`ë¥¼ `return` í•˜ëŠ” `add20` í•¨ìˆ˜ë¥¼ ì‚¬ìš© ì‹œ ê°€ë…ì„±ì—ì„œ ë¹„êµìš°ìœ„ì— ìžˆë‹¤ëŠ” ì ì´ `Callback` í˜•ì‹ì˜ ì½”ë”©ê³¼ ë‹¤ë¥¸ì ì´ë‹¤.

í•˜ì§€ë§Œ ê°€ìž¥ í° ì°¨ì´ëŠ” `Promise` ê°€ **ë¹„ë™ê¸° ìƒí™©ì„ ì¼ê¸‰ ê°’ìœ¼ë¡œ ë‹¤ë£¬ë‹¤ëŠ” ì **ì´ ê°€ìž¥ ë‹¤ë¥´ë‹¤.

`Promise`ëŠ” **ë¹„ë™ê¸° ìƒí™©ì´ ì½”ë“œê°€ ì•„ë‹Œ ê°’ìœ¼ë¡œì¨ ë‹¤ë¤„ì§„ë‹¤ëŠ” ì **ì¸ë° ì•„ëž˜ ì½”ë“œë¥¼ ë´ë³´ìž.

```js

var a = add10(5, res => {
  add10(res, res => {
    add10(res, res => {
    });
  });
});

console.log(a); // 1. undefined

function add20(a) {
  return new Promise(resolve => setTimeout(() => resolve(a + 20), 100));
}

var b = add20(5)
	.then(add20)
	.then(add20)

console.log(b) // 2. PromiseÂ {<pending>}
```

`1.` `2.` ì—ì„œ ìœ„ `callback` ê·¸ì € í•¨ìˆ˜ë¡œì¨ ì•”ë¬µì ì¸ ë¦¬í„´ ê°’ì¸ `undefined`ë¥¼ ë°˜í™˜í•˜ì§€ë§Œ 2. ì—ì„œëŠ” `promise` ë¥¼ ë¦¬í„´í•œë‹¤.

ê°’ìœ¼ë¡œ ì´ëŸ¬í•œ ë¦¬í„´ê°’ì´ ë‹¤ë¤„ì§„ë‹¤ëŠ” ì ì€ ì¼ê¸‰ì´ë¼ëŠ” ê²ƒì´ê³ , ì´ ë§ì€ ë³€ìˆ˜ì—ë„ í• ë‹¹ ê°€ëŠ¥í•˜ê³  ì–´ë–¤ í•¨ìˆ˜ì—ë„ ì „ë‹¬ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ë§ì´ë‹¤.

> `Promise`ê°€ ë¹„ë™ê¸° ìƒí™©ì„ ê°’ìœ¼ë¡œì¨ ë‹¤ë£¨ê¸° ë•Œë¬¸ì— ì¼ê¸‰ì´ë©°, ì¼ê¸‰ì´ê¸° ë•Œë¬¸ì— í•¨ìˆ˜ë¡œ ì „ë‹¬í•  ìˆ˜ ìžˆê³ , ì´ëŸ¬í•œ ì „ë‹¬ëœ ê°’ì„ í†µí•´ì„œ ê³„ì† ìž‘ì—…ì„ ì´ì–´ë‚˜ê°ˆ ìˆ˜ ìžˆë‹¤ëŠ” ì ì´ `Callback`ê³¼ ê°€ìž¥ í° ì°¨ì´ê°€ ëœë‹¤.

## ðŸ“—ê°’ìœ¼ë¡œ ë‹¤ë¤„ì§€ëŠ” Promiseë¥¼ ê³ ë ¤í•´ì„œ ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•´ë³´ìž

ê¸°ì¡´ `go` í•¨ìˆ˜ëŠ” `promise` ìƒí™©ì— ëŒ€í•œ ê³ ë ¤ë¥¼ í•˜ì§€ ì•Šì•˜ë‹¤. ë”°ë¼ì„œ `Promise` ê°€ ì¸ìžë¡œ ë“¤ì–´ì˜¬ê²½ìš°ë¥¼ ê³ ë ¤í•˜ë©´,

```js

const delay100 = a => new Promise(resolve =>
  setTimeout(() => resolve(a), 100));
  
const go1 = (a, f) => a instanceof Promise ? a.then(f) : f(a);
const add5 = a => a + 5;
const n1 = 10;

// log(go1(go1(n1, add5), log));
const n2 = delay100(10);
// log(go1(go1(n2, add5), log));
```

ìœ„ì™€ ê°™ì´ ë‹¨ìˆœí•˜ê²Œ ì¸ìžê°€ `Promise`ì¼ì‹œ `then`ì„ ì‹¤í–‰í•´ì„œ ë¦¬í„´í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤€ë‹¤ë©´ `Promise`ë¥¼ ë‹¤ë£° ìˆ˜ ìžˆë‹¤.

### go í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•´ë³´ìž

ê·¸ë ‡ë‹¤ë©´ `go` í•¨ìˆ˜ë¥¼ ì¤‘ê°„ì— `Promiseë¥¼` ì²˜ë¦¬í•  ìˆ˜ ìžˆê²Œ ìˆ˜ì •í•´ë³´ìž.

```js
go(Promise.resolve(1),
    a => a + 10,
    Promise.resolve(10),
    a => a + 1000,
    a => a + 10000,
    log);
```

`go` ëŠ” `reduce` í•¨ìˆ˜ë¥¼ í†µí•´ ì¸ìžë¡œ ì „ë‹¬ ë°›ì€ ëª¨ë“  í•¨ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— `reduce`ì—ì„œ `Promise` ê°€ ì‹¤í–‰ë˜ê²Œ ë” ìˆ˜ì •í•´ì•¼ í•œë‹¤. ê°„ë‹¨í•˜ê²Œ `reduce`ë¥¼ ìˆ˜ì •í•œë‹¤ë©´ ì•„ëž˜ì™€ ê°™ë‹¤.

```js
const reduce = curry((f, acc, iter) => {
  if (!iter) {
    iter = acc[Symbol.iterator]();
    acc = iter.next().value;
  } else {
    iter = iter[Symbol.iterator]();
  }
  let cur;
  while (!(cur = iter.next()).done) {
    const a = cur.value;
    // acc = f(acc, a); ë³€ê²½ì „
    acc = acc instanceof Promise ? acc.then(acc => f(acc, a)) : f(acc, a);
  }
  return acc;
});

```

ë‹¨ìˆœížˆ ìœ„ ì½”ë“œë¥¼ ë³´ë©´ ë¬¸ì œ ì—†ëŠ” ì½”ë“œë¡œ ë³´ì¼ ìˆ˜ ìžˆì§€ë§Œ,  ì„±ëŠ¥ ì €í•˜ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìžˆë‹¤. ì™œ ê·¸ëŸ´ê¹Œ?

ì•„ëž˜ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ê³ ,

```js
const delay100 = a => new Promise(resolve =>  
    setTimeout(() => {  
        console.log(new Date().getTime())  
        resolve(a)  
    }, 1000 * Math.random()));  
  
go(1,  
    a => a + 10,  
    a => delay100(delay100(delay100(delay100(a + 10)))),  
    a => a + 1000,  
    a => a + 10000,  
    log);
```

 `reduce` ë¶€ë¶„ì„ ë””ë²„ê¹… í•˜ì—¬ ì´ìœ ë¥¼ í™•ì¸í•´ë³´ìž.

![[ê°œì„ ì „.gif]]

`go`ì—ì„œ `Promise` ì½”ë“œë¥¼ ì‹¤í–‰í•œ ì´í›„ì˜ ì½”ë“œë“¤ì´ ì „ë¶€ ë¹„ë™ê¸° ìƒí™©ì¸ `Promise.then()` ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìžˆë‹¤.

ìžë°”ìŠ¤í¬ë¦½íŠ¸ì˜ íŠ¹ì„±ìƒ ë¹„ë™ê¸° ìƒí™©ì— ë§Žì€ ë¡œì§ì´ ë“¤ì–´ê°€ ìžˆëŠ” ê²ƒì€ ì¢‹ì§€ ì•Šë‹¤. ì™œ ê·¸ëŸ´ê¹Œ?

### Micro Task Queue ì™€ ì´ë²¤íŠ¸ ë£¨í”„

ìœ„ ì½”ë“œì—ì„œëŠ” `Promise`ì•ˆì—ì„œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë¯€ë¡œ `Promise`ì˜ `Callback` í•¨ìˆ˜ì—ì„œ ì´í›„ í•¨ìˆ˜ë“¤ë„ ì‹¤í–‰ëœë‹¤. ìžë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ, `Promise`ì˜ `Callback` í•¨ìˆ˜ë“¤ì€ [**ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ í**](https://baeharam.netlify.app/posts/javascript/JS-Task%EC%99%80-Microtask%EC%9D%98-%EB%8F%99%EC%9E%91%EB%B0%A9%EC%8B%9D)ì— ìŒ“ì¸ë‹¤.

Call Stack ì´ ì „ë¶€ ë¹„ì›Œì ¸ì•¼ë§Œ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íì—ì„œ ìž‘ì—…ì„ ê°€ì ¸ì™€ì„œ ì‹¤í–‰í•˜ë¯€ë¡œ, ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íì— ë§Žì€ ìž‘ì—…, ì¦‰ ë¹„ë™ê¸° ìƒí™©ì—ì„œ ë§Žì€ taskê°€ ìžˆë‹¤ë©´ ë¶€í•˜ê°€ ê±¸ë¦´ ìˆ˜ ìžˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ goì—ì„œ 






```js
const reduce = curry((f, acc, iter) => {
  if (!iter) {
    iter = acc[Symbol.iterator]();
    acc = iter.next().value;
  } else {
    iter = iter[Symbol.iterator]();
  }
  return go1(acc, function recur(acc) {
    let cur;
    while (!(cur = iter.next()).done) {
      const a = cur.value;
      acc = f(acc, a);
      if (acc instanceof Promise) return acc.then(recur);
    }
    return acc;
  });
});
```